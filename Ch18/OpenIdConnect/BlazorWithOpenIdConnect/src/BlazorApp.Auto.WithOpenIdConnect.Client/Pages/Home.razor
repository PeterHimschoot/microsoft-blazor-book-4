@page "/"
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@using System.Security.Claims
@* @attribute [Authorize] *@

<PageTitle>Home</PageTitle>

<h1>Welcome @UserName</h1>

@if (Claims is not null)
{
  foreach (Claim claim in Claims)
  {
    <p>@claim.Type - @claim.Value</p>
  }

  <p>@OperatingSystem.IsBrowser()</p>
}

@code {

  [Inject]
  public required AuthenticationStateProvider
    AuthenticationStateProvider
  { get; set; }

  private IEnumerable<Claim>? Claims { get; set; }

  public string UserName { get; set; } = "Unknown";

  protected override async Task OnInitializedAsync()
  {
    AuthenticationState authState =
      await AuthenticationStateProvider
              .GetAuthenticationStateAsync();

    if (authState is not null)
    {
      Claims = authState.User.Claims;
      Claim? givenNameClaim =
        authState.User.FindFirst("given_name");
      if (givenNameClaim is not null)
      {
        UserName = givenNameClaim.Value;
      }
    }
  }
}