@page "/protected-counter"
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage

<PageTitle>Counter</PageTitle>

<h1>Counter</h1>

<p role="status">Current count: @currentCount</p>

<button class="btn btn-primary" @onclick="IncrementCount">Click me</button>

@code {

  [Inject]
  public required ProtectedLocalStorage localStorage { get; set; }

  private int currentCount = 0;

  private async Task IncrementCount()
  {
    currentCount++;
    await localStorage.SetAsync("counter", currentCount);
  }

  protected override async Task OnInitializedAsync()
  {
    var state = await localStorage.GetAsync<int>("counter");
    if (state.Success)
    {
      currentCount = state.Value;
    }
  }
}
